## Микросервис генерации телематики
Этот микросервис разработан для генерации случайных данных телематики и их трансляции в Kafka. Он также предоставляет API (gRPC) для получения данных телематики за заданный диапазон дат и получения последней записи.

### Установка и запуск
В корневой директории проекта выполните команду **docker-compose up** для разворачивания микросервиса.

### API (gRPC) методы
#### Получить последнюю запись:
**GetLatestData** - этот метод не принимает аргументов и возвращает последнюю сгенерированную запись (в виде экземпляра структуры TelematicsDataProto). В этой записи представлены идентификатор ТС, временная метка, скорость, широта и долгота.
#### Получить телематику за заданный диапазон дат:
**GetRangeData** - этот метод принимает RangeDataRequest, который содержит временные метки начала и конца интервала *(например {"from_timestamp":1689171311532320300, "to_timestamp":1689171317532360400})*, и возвращает поток телематических данных (TelematicsDataProto), которые были сгенерированы в заданный период времени.

Данные начинают генерироваться и записываться с момента запуска приложения, поэтому запрос данных за временной интервал, предшествующий запуску приложения, невозможен. В случае подобного запроса будет возвращена ошибка с указанием временного диапазона, за который данные доступны.

### Конфигурация
Конфигурационные параметры микросервиса могут быть настроены в файле **config.yaml**. В нем можно указать следующие параметры:

- **vehiclesCount**: Количество транспортных средств для генерации телематики.
- **maxSpeed**: Максимальная скорость транспортного средства, км/ч
- **maxTimeStep**: Максимальный шаг времени, сек
- **cacheSize**: Размер кеша памяти, кол-во записей
- **brokerHost**: Адрес брокера Kafka для отправки данных.
- **topicName**: Название топика Kafka для отправки данных.
- **grpsPort**: Порт gRPC

### Зависимости
Для разработки и запуска микросервиса использовались следующие зависимости:

- **github.com/spf13/viper** - Библиотека для работы с конфигурационными файлами в формате YAML;
- **github.com/kellydunn/golang-geo** - Библиотека для расчета координат последующей точки;
- **github.com/segmentio/kafka-go** - Клиент Kafka для отправки сообщений;
- **google.golang.org/protobuf** - Библиотека для работы с protobuf;
- **google.golang.org/grpc** - Библиотека для работы с gRPC.

### Описание архитектуры:

Микросервис представляет собой приложение, написанное на языке Go, и состоит из следующих основных компонентов:

 - **Генератор телематических данных (generator)**: этот компонент генерирует случайные телематические данные для заданного количества транспортных средств с определенной максимальной скоростью и временным шагом. Каждый цикл генерации представляет собой новую "строку" телематики для транспортного средства, включающую идентификатор ТС, скорость, координаты и временную метку.
 - **Кеш данных (cache)**: здесь хранятся последние сгенерированные телематические данные. Кеш имеет ограниченный размер и работает по принципу FIFO (First-In-First-Out). Таким образом, старые данные будут удаляться по мере поступления новых.
 - **Kafka Producer (kafka)**: этот компонент отвечает за отправку сгенерированных данных в Kafka. Каждая запись телематики, сгенерированная генератором, передается в Kafka на определенный топик.
 - **gRPC сервер (grpc)**: gRPC сервер предоставляет два метода API - получение последней записи из кеша и получение данных за заданный диапазон времени.

В качестве структуры хранения данных выбран **map с ключем Timestamp**. Программа предусматривает возможность генерации данных для множества транспортных средств, и, хотя вероятность того, что несколько ТС окажутся с абсолютно идентичным Timestamp существует, она чрезвычайно мала. Поэтому принято решение пренебречь такими случаями. Такой подход обеспечивает простоту реализации поиска по заданным временным промежуткам, вывод последней добавленной записи и удаление самых ранних записей при достижении максимального размера кеша.